import{_ as J}from"./PageContainer.vue_vue_type_style_index_0_lang-51e4b11c.js";import{d as j,z as g,l as i,C as K,o as u,c as d,F as H,q as O,f as F,a as r,e as k,S as U,t as x,B as W,s as T,p as Z,i as ee,_ as se,b as te,n as ne,y as oe,I as ae,E as le,m as ie,w as L,u as h,v as S,g as z,x as re,L as ce,A as ue}from"./index-2c588c1a.js";import{u as de}from"./math-c3d3a642.js";import{B as X}from"./BasicButton-1db933da.js";import{g as ve,b as P,a as fe}from"./beansAndBlends-f317c59d.js";const $=_=>(Z("data-v-d9725202"),_=_(),ee(),_),pe=$(()=>r("div",{class:"line"},null,-1)),he={class:"image"},ge=$(()=>r("div",{class:"dot"},null,-1)),_e={class:"label"},we=["onClick"],me=$(()=>r("div",{class:"circle"},null,-1)),Se=[me],xe=j({__name:"SlidingSelector",props:{lang:{},idx:{},selection:{},iconsSrc:{},iconsY:{},left:{},right:{},answers:{},showAnswerLabel:{type:Boolean},selectAnswer:{type:Function}},setup(_){const a=_,v=g(!1),I=i(()=>a.answers.length-1),y=g(0),l=i(()=>(v.value?y.value:a.selection/(a.answers.length-1))*100);function f(t){v.value=!0,w(t),window.addEventListener("touchend",p),window.addEventListener("touchmove",w)}function w(t){const c=t.changedTouches[0];c&&v.value&&(y.value=de(c.clientX,a.left,a.right,!0),B())}function A(){const t=Math.round(y.value*I.value),c=a.answers[t];a.selectAnswer(a.idx,c.idx)}const B=K.debounce(A,30);function p(){v.value=!1,window.removeEventListener("touchend",p),window.removeEventListener("touchmove",w)}return(t,c)=>(u(),d("div",{class:F(["sliding-selector",{labeled:t.showAnswerLabel}]),onTouchstart:f},[pe,(u(!0),d(H,null,O(t.answers,(C,m)=>(u(),d("div",{key:m,class:F(["answer",{selected:m==t.selection}])},[r("div",he,[ge,k(U,{class:"icon",src:t.iconsSrc,"x-sprites":12,"y-sprites":8,x:t.answers[m].idx,y:t.iconsY},null,8,["src","x","y"])]),r("div",_e,x(C.text[t.lang]),1),r("div",{class:"hit-rect",onClick:E=>t.selectAnswer(t.idx,t.answers[m].idx)},null,8,we)],2))),128)),t.selection!=null?(u(),d("div",{key:0,class:"selection",style:W({left:l.value+"%"})},Se,4)):T("",!0)],34))}});const ye=se(xe,[["__scopeId","data-v-d9725202"]]),be={key:0,class:"instruction"},qe={class:"step-number"},ke={key:0,class:"question-text"},Ie={class:"nav-row"},Y=4,Ae="scene-mix/area-3-icons.webp",$e=j({__name:"SceneMixPage",setup(_){const a=te(),v=ne(),I=oe(),y=i(()=>I.lang),l=i(()=>re.currentRoute.value.meta.questionSettings||null),f=i(()=>{var e;return((e=l.value)==null?void 0:e.questionIdx)||0}),w=i(()=>{if(!l.value||f.value==null)return null;const e=[l.value];for(let n=1;n<(l.value.nQuestions||1);n++)e.push(Object.assign({},l.value,{questionIdx:f.value+n}));return e}),A=i(()=>{const e=[];if(l.value)for(let n=0;n<(l.value.nQuestions||1);n++)e.push(ce[f.value+n]);return e}),B=i(()=>{var e;return((e=l.value)==null?void 0:e.nQuestions)||1}),p=i(()=>{let e=[];if(l.value){const n=ue[l.value.areaIdx];for(let s=0;s<B.value;s++)e.push(n[f.value+s])}return e}),t=i(()=>w.value?w.value.map(e=>a.getQuestionHistory(e.areaIdx,e.questionIdx)):[]),c=i(()=>t.value.map((e,n)=>{const s=p.value[n].answers[e.sas[0]];if(s)return s.displayIdx!=null?s.displayIdx:s.idx||0})),C=i(()=>{for(let e=0;e<c.value.length;e++)if(c.value[e]==null)return!1;return!0});function m(e,n){const s=t.value[e];s.sas[0]=n,a.updateQuestionScores(s,p.value[e])}const E=g(null),M=g(null),b=g([]);ae(()=>{const e=p.value;let n=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=Y){n=!0;break}if(v.isLimitingAnswers||(n=!1),n){const s=ve(4,fe,P,a.progress.scores);for(let o=0;o<e.length;o++){const R=e[o];if(R.answers.length<=Y)b.value[o]=e[o].answers;else{const V=[];b.value[o]=V;for(let q=0;q<s.length;q++){const G=P[s[q]],D=R.answers[G.idx];D.displayIdx=q,V.push(D)}}}}else for(let s=0;s<e.length;s++)b.value[s]=e[s].answers});const Q=g(0),N=g(0);return le(()=>{const e=E.value.getClientRects()[0],n=M.value.getClientRects()[0];Q.value=n.left-e.left,N.value=n.right-e.left}),(e,n)=>(u(),ie(J,{"inner-class":{"scene-mix-page":!0}},{default:L(()=>[r("div",{ref_key:"interfaceEl",ref:E,class:"interface"},[h(S)("instruction")?(u(),d("div",be,x(h(S)("instruction")),1)):T("",!0),r("div",{ref_key:"questionsEl",ref:M,class:"questions"},[r("div",qe,x(h(S)("number")),1),(u(!0),d(H,null,O(p.value,(s,o)=>(u(),d("div",{key:o,class:"question"},[h(S)("question")?(u(),d("p",ke,x(h(S)("question")),1)):T("",!0),k(ye,{lang:y.value,idx:o,selection:c.value[o],"icons-src":Ae,"icons-y":f.value+o,left:Q.value,right:N.value,answers:b.value[o],"show-answer-label":A.value[o].showAnswerLabel,"select-answer":m},null,8,["lang","idx","selection","icons-y","left","right","answers","show-answer-label"])]))),128))],512),r("div",Ie,[k(X,{class:"back-button",secondary:"",onClick:h(v).onBack},{default:L(()=>[z(x("<<"))]),_:1},8,["onClick"]),k(X,{class:"next-button",disabled:!C.value},{default:L(()=>[z(x(h(S)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{$e as default};
