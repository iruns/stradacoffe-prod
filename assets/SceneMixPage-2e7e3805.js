import{_ as J}from"./PageContainer.vue_vue_type_style_index_0_lang-60cdfe3d.js";import{d as j,z as g,l as i,C as K,o as u,c as d,F as H,q as O,f as F,a as c,e as k,S as U,t as y,B as W,s as T,p as Z,i as ee,_ as se,b as te,n as ne,y as oe,I as ae,E as le,m as ie,w as L,u as h,v as x,g as X,x as re,L as ce,A as ue}from"./index-56ebd70a.js";import{u as de}from"./math-c3d3a642.js";import{B as z}from"./BasicButton-efb65a37.js";import{g as ve,b as P,a as fe}from"./beansAndBlends-3de3d071.js";const $=_=>(Z("data-v-275ead9d"),_=_(),ee(),_),pe=$(()=>c("div",{class:"line"},null,-1)),he={class:"image"},ge=$(()=>c("div",{class:"dot"},null,-1)),_e={class:"label"},we=["onClick"],me=$(()=>c("div",{class:"circle"},null,-1)),Se=[me],xe=j({__name:"SlidingSelector",props:{lang:{},idx:{},selection:{},iconsSrc:{},iconsY:{},left:{},right:{},answers:{},showAnswerLabel:{type:Boolean},selectAnswer:{type:Function}},setup(_){const o=_,v=g(!1),I=i(()=>o.answers.length-1),w=g(0),l=i(()=>(v.value?w.value:o.selection/(o.answers.length-1))*100);function f(t){v.value=!0,m(t),window.addEventListener("touchend",p),window.addEventListener("touchmove",m)}function m(t){const r=t.changedTouches[0];r&&v.value&&(w.value=de(r.clientX,o.left,o.right,!0),console.log(r.clientX,w.value,o.left,o.right),B())}function A(){const t=Math.round(w.value*I.value),r=o.answers[t];o.selectAnswer(o.idx,r.idx)}const B=K.debounce(A,30);function p(){v.value=!1,window.removeEventListener("touchend",p),window.removeEventListener("touchmove",m)}return(t,r)=>(u(),d("div",{class:F(["sliding-selector",{labeled:t.showAnswerLabel}]),onTouchstart:f},[pe,(u(!0),d(H,null,O(t.answers,(C,S)=>(u(),d("div",{key:S,class:F(["answer",{selected:S==t.selection}])},[c("div",he,[ge,k(U,{class:"icon",src:t.iconsSrc,"x-sprites":12,"y-sprites":8,x:t.answers[S].idx,y:t.iconsY},null,8,["src","x","y"])]),c("div",_e,y(C.text[t.lang]),1),c("div",{class:"hit-rect",onClick:E=>t.selectAnswer(t.idx,t.answers[S].idx)},null,8,we)],2))),128)),t.selection!=null?(u(),d("div",{key:0,class:"selection",style:W({left:l.value+"%"})},Se,4)):T("",!0)],34))}});const ye=se(xe,[["__scopeId","data-v-275ead9d"]]),be={key:0,class:"instruction"},qe={class:"step-number"},ke={key:0,class:"question-text"},Ie={class:"nav-row"},Y=4,Ae="scene-mix/area-3-icons.webp",$e=j({__name:"SceneMixPage",setup(_){const o=te(),v=ne(),I=oe(),w=i(()=>I.lang),l=i(()=>re.currentRoute.value.meta.questionSettings||null),f=i(()=>{var e;return((e=l.value)==null?void 0:e.questionIdx)||0}),m=i(()=>{if(!l.value||f.value==null)return null;const e=[l.value];for(let n=1;n<(l.value.nQuestions||1);n++)e.push(Object.assign({},l.value,{questionIdx:f.value+n}));return e}),A=i(()=>{const e=[];if(l.value)for(let n=0;n<(l.value.nQuestions||1);n++)e.push(ce[f.value+n]);return e}),B=i(()=>{var e;return((e=l.value)==null?void 0:e.nQuestions)||1}),p=i(()=>{let e=[];if(l.value){const n=ue[l.value.areaIdx];for(let s=0;s<B.value;s++)e.push(n[f.value+s])}return e}),t=i(()=>m.value?m.value.map(e=>o.getQuestionHistory(e.areaIdx,e.questionIdx)):[]),r=i(()=>t.value.map((e,n)=>{const s=p.value[n].answers[e.sas[0]];if(s)return s.displayIdx!=null?s.displayIdx:s.idx||0})),C=i(()=>{for(let e=0;e<r.value.length;e++)if(r.value[e]==null)return!1;return!0});function S(e,n){const s=t.value[e];s.sas[0]=n,o.updateQuestionScores(s,p.value[e])}const E=g(null),M=g(null),b=g([]);ae(()=>{const e=p.value;let n=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=Y){n=!0;break}if(v.isLimitingAnswers||(n=!1),n){const s=ve(4,fe,P,o.progress.scores);for(let a=0;a<e.length;a++){const R=e[a];if(R.answers.length<=Y)b.value[a]=e[a].answers;else{const V=[];b.value[a]=V;for(let q=0;q<s.length;q++){const G=P[s[q]],D=R.answers[G.idx];D.displayIdx=q,V.push(D)}}}}else for(let s=0;s<e.length;s++)b.value[s]=e[s].answers});const Q=g(0),N=g(0);return le(()=>{const e=E.value.getClientRects()[0],n=M.value.getClientRects()[0];Q.value=n.left-e.left,N.value=n.right-e.left}),(e,n)=>(u(),ie(J,{"inner-class":{"scene-mix-page":!0}},{default:L(()=>[c("div",{ref_key:"interfaceEl",ref:E,class:"interface"},[h(x)("instruction")?(u(),d("div",be,y(h(x)("instruction")),1)):T("",!0),c("div",{ref_key:"questionsEl",ref:M,class:"questions"},[c("div",qe,y(h(x)("number")),1),(u(!0),d(H,null,O(p.value,(s,a)=>(u(),d("div",{key:a,class:"question"},[h(x)("question")?(u(),d("p",ke,y(h(x)("question")),1)):T("",!0),k(ye,{lang:w.value,idx:a,selection:r.value[a],"icons-src":Ae,"icons-y":f.value+a,left:Q.value,right:N.value,answers:b.value[a],"show-answer-label":A.value[a].showAnswerLabel,"select-answer":S},null,8,["lang","idx","selection","icons-y","left","right","answers","show-answer-label"])]))),128))],512),c("div",Ie,[k(z,{class:"back-button",secondary:"",onClick:h(v).onBack},{default:L(()=>[X(y("<<"))]),_:1},8,["onClick"]),k(z,{class:"next-button",disabled:!C.value},{default:L(()=>[X(y(h(x)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{$e as default};
