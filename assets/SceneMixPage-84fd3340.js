import{_ as Z}from"./PageContainer.vue_vue_type_style_index_0_lang-6f44bd57.js";import{d as ee,b as se,n as te,x as ne,k as a,y,H as oe,D as ae,B as le,l as ie,w as b,o as u,a as l,u as d,s as f,c as v,t as h,q as S,m as R,e as ue,F as V,A as $,f as k,S as re,i as z,v as ce,K as de,z as ve}from"./index-ca6b6884.js";import{B as F}from"./BasicButton-7a083e5d.js";import{u as fe}from"./math-c3d3a642.js";import{g as he,b as H,a as _e}from"./beansAndBlends-a007d6ac.js";const pe={key:0,class:"instruction"},ge={class:"step-number"},me=["onTouchstart"],xe={key:0,class:"question-text"},we=l("div",{class:"line"},null,-1),ye=l("div",{class:"dot"},null,-1),be={class:"label"},Se=["onClick"],ke=l("div",{class:"circle"},null,-1),qe=[ke],Be={class:"nav-row"},P=4,Ce="scene-mix/area-3-icons.webp",Qe=ee({__name:"SceneMixPage",setup(Ee){const w=se(),q=te(),j=ne(),K=a(()=>j.lang),o=a(()=>ce.currentRoute.value.meta.questionSettings||null),_=a(()=>{var e;return((e=o.value)==null?void 0:e.questionIdx)||0}),B=a(()=>{if(!o.value||_.value==null)return null;const e=[o.value];for(let t=1;t<(o.value.nQuestions||1);t++)e.push(Object.assign({},o.value,{questionIdx:_.value+t}));return e}),O=a(()=>{const e=[];if(o.value)for(let t=0;t<(o.value.nQuestions||1);t++)e.push(de[_.value+t]);return e}),X=a(()=>{var e;return((e=o.value)==null?void 0:e.nQuestions)||1}),m=a(()=>{let e=[];if(o.value){const t=ve[o.value.areaIdx];for(let s=0;s<X.value;s++)e.push(t[_.value+s])}return e}),C=a(()=>B.value?B.value.map(e=>w.getQuestionHistory(e.areaIdx,e.questionIdx)):[]),x=a(()=>C.value.map((e,t)=>{const s=m.value[t].answers[e.sas[0]];if(s)return s.displayIdx!=null?s.displayIdx:s.idx||0})),G=a(()=>{for(let e=0;e<x.value.length;e++)if(x.value[e]==null)return!1;return!0});function E(e,t){const s=C.value[e];s.sas[0]=t,w.updateQuestionScores(s,m.value[e])}const I=y(null),T=y(null);let A=0,M=0,p=-1,L=-1;const i=y([]);oe(()=>{const e=m.value;let t=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=P){t=!0;break}if(q.isLimitingAnswers||(t=!1),t){const s=he(4,_e,H,w.progress.scores);for(let n=0;n<e.length;n++){const r=e[n];if(r.answers.length<=P)i.value[n]=e[n].answers;else{const c=[];i.value[n]=c;for(let g=0;g<s.length;g++){const Y=H[s[g]],D=r.answers[Y.idx];D.displayIdx=g,c.push(D)}}}}else for(let s=0;s<e.length;s++)i.value[s]=e[s].answers}),ae(()=>{const e=I.value.getClientRects()[0],t=T.value.getClientRects()[0];A=t.left-e.left,M=t.right-e.left});function J(e){p=e,L=i.value[e].length-1,window.addEventListener("touchend",N),window.addEventListener("touchmove",Q)}function U(e){const t=e.changedTouches[0];if(t&&p>=0){const s=fe(t.clientX,A,M,!0),n=Math.round(s*L),r=i.value[p][n];E(p,r.idx)}}const Q=le.debounce(U,30);function N(){p=-1,window.removeEventListener("touchend",N),window.removeEventListener("touchmove",Q)}const W=[{},{}];return(e,t)=>(u(),ie(Z,{"inner-class":{"scene-mix-page":!0}},{default:b(()=>[l("div",{ref_key:"interfaceEl",ref:I,class:"interface"},[d(f)("instruction")?(u(),v("div",pe,h(d(f)("instruction")),1)):S("",!0),l("div",{ref_key:"questionsEl",ref:T,class:"questions"},[l("div",ge,h(d(f)("number")),1),(u(!0),v(V,null,R(m.value,(s,n)=>(u(),v("div",{key:n,class:"question",onTouchstart:r=>J(n)},[d(f)("question")?(u(),v("p",xe,h(d(f)("question")),1)):S("",!0),l("div",{class:ue(["answers",{labeled:O.value[n].showAnswerLabel}])},[we,(u(!0),v(V,null,R(i.value[n],(r,c)=>(u(),v("div",{key:c,class:"answer",style:$(W[c])},[ye,k(re,{class:"icon",src:Ce,"x-sprites":12,"y-sprites":8,x:i.value[n][c].idx,y:_.value+n},null,8,["x","y"]),l("div",be,h(r.text[K.value]),1),l("div",{class:"hit-rect",onClick:g=>E(n,i.value[n][c].idx)},null,8,Se)],4))),128)),x.value[n]!=null?(u(),v("div",{key:0,class:"selection",style:$({left:x.value[n]/(i.value[n].length-1)*100+"%"})},qe,4)):S("",!0)],2)],40,me))),128))],512),l("div",Be,[k(F,{class:"back-button",secondary:"",onClick:d(q).onBack},{default:b(()=>[z(h("<<"))]),_:1},8,["onClick"]),k(F,{class:"next-button",disabled:!G.value},{default:b(()=>[z(h(d(f)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{Qe as default};
