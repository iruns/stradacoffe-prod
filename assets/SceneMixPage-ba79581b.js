import{_ as J}from"./PageContainer.vue_vue_type_style_index_0_lang-945d7213.js";import{d as j,z as y,l as i,C as K,o as d,c as v,F as H,q as O,f as F,a as r,e as k,S as U,t as S,B as W,s as T,p as Z,i as ee,_ as se,b as te,n as ne,y as oe,I as ae,E as le,m as ie,w as L,u,v as m,g as z,x as re,L as ce,A as ue}from"./index-36219601.js";import{u as de}from"./math-c3d3a642.js";import{B as X}from"./BasicButton-84f215ff.js";import{g as ve,b as P,a as fe}from"./beansAndBlends-8612d7d8.js";const $=g=>(Z("data-v-d9725202"),g=g(),ee(),g),pe=$(()=>r("div",{class:"line"},null,-1)),he={class:"image"},ge=$(()=>r("div",{class:"dot"},null,-1)),_e={class:"label"},we=["onClick"],me=$(()=>r("div",{class:"circle"},null,-1)),Se=[me],xe=j({__name:"SlidingSelector",props:{lang:{},idx:{},selection:{},iconsSrc:{},iconsY:{},left:{},right:{},answers:{},showAnswerLabel:{type:Boolean},selectAnswer:{type:Function}},setup(g){const a=g,f=y(!1),I=i(()=>a.answers.length-1),x=y(0),l=i(()=>(f.value?x.value:a.selection/(a.answers.length-1))*100);function p(t){f.value=!0,_(t),window.addEventListener("touchend",h),window.addEventListener("touchmove",_)}function _(t){const c=t.changedTouches[0];c&&f.value&&(x.value=de(c.clientX,a.left,a.right,!0),B())}function A(){const t=Math.round(x.value*I.value),c=a.answers[t];a.selectAnswer(a.idx,c.idx)}const B=K.debounce(A,30);function h(){f.value=!1,window.removeEventListener("touchend",h),window.removeEventListener("touchmove",_)}return(t,c)=>(d(),v("div",{class:F(["sliding-selector",{labeled:t.showAnswerLabel}]),onTouchstart:p},[pe,(d(!0),v(H,null,O(t.answers,(C,w)=>(d(),v("div",{key:w,class:F(["answer",{selected:w==t.selection}])},[r("div",he,[ge,k(U,{class:"icon",src:t.iconsSrc,"x-sprites":12,"y-sprites":8,x:t.answers[w].idx,y:t.iconsY},null,8,["src","x","y"])]),r("div",_e,S(C.text[t.lang]),1),r("div",{class:"hit-rect",onClick:E=>t.selectAnswer(t.idx,t.answers[w].idx)},null,8,we)],2))),128)),t.selection!=null?(d(),v("div",{key:0,class:"selection",style:W({left:l.value+"%"})},Se,4)):T("",!0)],34))}});const ye=se(xe,[["__scopeId","data-v-d9725202"]]),be={key:0,class:"instruction"},qe={class:"step-number"},ke={key:0,class:"question-text"},Ie={class:"nav-row"},Y=4,Ae="scene-mix/area-3-icons.webp",$e=j({__name:"SceneMixPage",setup(g){const a=te(),f=ne(),I=oe(),x=i(()=>I.lang),l=i(()=>re.currentRoute.value.meta.questionSettings||null),p=i(()=>{var e;return((e=l.value)==null?void 0:e.questionIdx)||0}),_=i(()=>{if(!l.value||p.value==null)return null;const e=[l.value];for(let n=1;n<(l.value.nQuestions||1);n++)e.push(Object.assign({},l.value,{questionIdx:p.value+n}));return e}),A=i(()=>{const e=[];if(l.value)for(let n=0;n<(l.value.nQuestions||1);n++)e.push(ce[p.value+n]);return e}),B=i(()=>{var e;return((e=l.value)==null?void 0:e.nQuestions)||1}),h=i(()=>{let e=[];if(l.value){const n=ue[l.value.areaIdx];for(let s=0;s<B.value;s++)e.push(n[p.value+s])}return e}),t=i(()=>_.value?_.value.map(e=>a.getQuestionHistory(e.areaIdx,e.questionIdx)):[]),c=i(()=>t.value.map((e,n)=>{const s=h.value[n].answers[e.sas[0]];if(s)return s.displayIdx!=null?s.displayIdx:s.idx||0})),C=i(()=>{for(let e=0;e<c.value.length;e++)if(c.value[e]==null)return!1;return!0});function w(e,n){const s=t.value[e];s.sas[0]=n,a.updateQuestionScores(s,h.value[e])}const E=y(null),M=y(null);let Q=0,N=0;const b=y([]);return ae(()=>{const e=h.value;let n=!1;for(let s=0;s<e.length;s++)if(e[s].answers.length>=Y){n=!0;break}if(f.isLimitingAnswers||(n=!1),n){const s=ve(4,fe,P,a.progress.scores);for(let o=0;o<e.length;o++){const R=e[o];if(R.answers.length<=Y)b.value[o]=e[o].answers;else{const V=[];b.value[o]=V;for(let q=0;q<s.length;q++){const G=P[s[q]],D=R.answers[G.idx];D.displayIdx=q,V.push(D)}}}}else for(let s=0;s<e.length;s++)b.value[s]=e[s].answers}),le(()=>{const e=E.value.getClientRects()[0],n=M.value.getClientRects()[0];Q=n.left-e.left,N=n.right-e.left}),(e,n)=>(d(),ie(J,{"inner-class":{"scene-mix-page":!0}},{default:L(()=>[r("div",{ref_key:"interfaceEl",ref:E,class:"interface"},[u(m)("instruction")?(d(),v("div",be,S(u(m)("instruction")),1)):T("",!0),r("div",{ref_key:"questionsEl",ref:M,class:"questions"},[r("div",qe,S(u(m)("number")),1),(d(!0),v(H,null,O(h.value,(s,o)=>(d(),v("div",{key:o,class:"question"},[u(m)("question")?(d(),v("p",ke,S(u(m)("question")),1)):T("",!0),k(ye,{lang:x.value,idx:o,selection:c.value[o],"icons-src":Ae,"icons-y":p.value+o,left:u(Q),right:u(N),answers:b.value[o],"show-answer-label":A.value[o].showAnswerLabel,"select-answer":w},null,8,["lang","idx","selection","icons-y","left","right","answers","show-answer-label"])]))),128))],512),r("div",Ie,[k(X,{class:"back-button",secondary:"",onClick:u(f).onBack},{default:L(()=>[z(S("<<"))]),_:1},8,["onClick"]),k(X,{class:"next-button",disabled:!C.value},{default:L(()=>[z(S(u(m)("continue","general")),1)]),_:1},8,["disabled"])])],512)]),_:1}))}});export{$e as default};
